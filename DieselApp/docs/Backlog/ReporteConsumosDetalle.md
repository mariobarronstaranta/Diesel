#  Reporte de Detalle de Consumos (Modal)

**Estado:**  En Desarrollo (Fase Visual)  
**Prioridad:** Alta  
**Ubicaci贸n:** Llamado desde `ReporteConsumos` (Bot贸n "Ver Detalle")

---

##  Descripci贸n General

Este componente es un modal que muestra el desglose detallado de los movimientos de combustible (entradas y salidas) para un tanque y fecha espec铆ficos seleccionados en el reporte principal de consumos.

---

##  Requerimientos Funcionales

1.  **Activaci贸n:** Debe abrirse al hacer clic en el bot贸n "Ver Detalle" de una fila en el reporte de consumos.
2.  **Organizaci贸n:** Los movimientos deben estar separados por tipo (Entradas y Salidas).
3.  **Visualizaci贸n:** Uso de tablas claras con encabezados descriptivos.
4.  **Exportaci贸n:** La tabla de Salidas debe contar con una opci贸n de exportaci贸n a CSV espec铆fica.

---

##  Estructura de Tablas

### 1. Movimientos de Entradas
| Columna | Descripci贸n |
| :--- | :--- |
| **Fecha** | Fecha del movimiento |
| **Hora** | Hora del movimiento |
| **Temperatura** | Temperatura registrada |
| **Litros** | Cantidad de combustible ingresada |
| **Planta** | Nombre de la planta |
| **Tanque** | Nombre del tanque |
| **CuentaLitros** | Lectura del medidor |

### 2. Movimientos de Salidas
| Columna | Descripci贸n |
| :--- | :--- |
| **Tanque** | Nombre del tanque |
| **Fecha** | Fecha del movimiento |
| **Hora** | Hora exacta |
| **Temperatura** | Temperatura registrada |
| **Unidad** | Veh铆culo/Unidad que recibi贸 el combustible |
| **Litros** | Cantidad de combustible despachada |
| **CuentaLitros** | Lectura del medidor |
| **Horometro** | Horometro registrado |
| **Odometro** | Odometro registrado |

---

##  Notas de Implementaci贸n (Fase Visual)

- Se utilizar谩 `react-bootstrap/Modal` y `react-bootstrap/Tabs`.
- Los datos mostrados ser谩n est谩ticos (mock data) para validaci贸n del cliente.
- El dise帽o debe ser responsivo y consistente con los colores institucionales.

---

## BACKEND IMPLEMENTATION

### Funci贸n Supabase: `get_salidas_detalle`

**Ubicaci贸n del Script**: [`docs/scripts/get_salidas_detalle.sql`](file:///c:/Users/85233588/Documents/Diesel/DieselApp/docs/scripts/get_salidas_detalle.sql)

#### Par谩metros de Entrada

| Par谩metro | Tipo | Descripci贸n |
| :--- | :--- | :--- |
| `p_fecha` | DATE | Fecha de los movimientos a consultar |
| `p_ciudad` | VARCHAR | Clave de la ciudad (CveCiudad) |
| `p_id_tanque` | BIGINT | ID del tanque (IDTanque) |

#### Columnas Retornadas

La funci贸n retorna una tabla con las siguientes columnas en el orden especificado:

| Columna | Tipo | Descripci贸n | Origen |
| :--- | :--- | :--- | :--- |
| **tanque** | TEXT | Nombre del tanque | `Tanque.Nombre` |
| **fecha** | DATE | Fecha del movimiento | `TanqueMovimiento.FechaCarga` |
| **hora** | TIME | Hora del movimiento | `TanqueMovimiento.HoraCarga` |
| **temperatura** | BIGINT | Temperatura registrada (掳C) | `TanqueMovimiento.TemperaturaCarga` |
| **unidad** | TEXT | ID + Clave alterna (formato: "IDClaveUnidad (ClaveAlterna)") | `Unidades.IDClaveUnidad + Unidades.ClaveAlterna` |
| **litros** | BIGINT | Cantidad de combustible despachada | `TanqueMovimiento.LitrosCarga` |
| **cuenta_litros** | BIGINT | Lectura del medidor | `TanqueMovimiento.CuentaLitros` |
| **horometro** | BIGINT | Hor贸metro registrado | `TanqueMovimiento.Horimetro` |
| **odometro** | BIGINT | Od贸metro registrado | `TanqueMovimiento.Odometro` |

#### Filtros Aplicados

- `TipoMovimiento = 'S'` (Solo movimientos de salida)
- `FechaCarga = p_fecha` (Coincidencia exacta de fecha)
- `CveCiudad = p_ciudad` (Ciudad especificada)
- `IdTanque = p_id_tanque` (Tanque espec铆fico)

#### Ordenamiento

Los resultados se ordenan por `HoraCarga` en orden ascendente.

---

## ESQUEMAS DE BASE DE DATOS

### Tabla: `TanqueMovimiento`

```sql
table public."TanqueMovimiento" (
  "IdTanqueMovimiento" bigint generated by default as identity not null,
  "CveCiudad" character varying not null,
  "IdTanque" bigint not null,
  "FechaCarga" date not null,
  "HoraCarga" time without time zone not null,
  "TemperaturaCarga" bigint not null,
  "LitrosCarga" bigint not null,
  "AlturaTanque" bigint null,
  "CuentaLitros" bigint null,
  "Remision" character varying null,
  "IdProveedor" bigint null,
  "Observaciones" character varying null,
  "TipoMovimiento" character varying null,
  "FechaHoraMovimiento" timestamp without time zone null,
  "IdUnidad" bigint null,
  "IdPersonal" bigint null,
  "FolioVale" character varying null,
  "Horimetro" bigint null,
  "Odometro" bigint null,
  constraint TanqueMovimiento_pkey primary key ("IdTanqueMovimiento")
) TABLESPACE pg_default;
```

### Tabla: `Tanque`

```sql
  "IDTanque" integer not null,
  "Nombre" text not null,
  "CveCiudad" text not null,
  "IDPlanta" integer not null,
  "Capacidad" bigint null,
  "IDTipoCombustible" integer null,
  "TipoCombustible" text null,
  "Forma" text null,
  "DiametroA" bigint null,
  "Largo" bigint null,
  idciudad character varying null,
  constraint Tanque_pkey primary key ("IDTanque"),
  constraint Tanque_IDTanque_key unique ("IDTanque"),
  constraint Tanque_IDPlanta_fkey foreign KEY ("IDPlanta") references "Planta" ("IDPlanta")
) TABLESPACE pg_default;

create table public."Unidades" (
  "IDUnidad" bigint not null,
  "IDClaveUnidad" text null,
  "ClaveAlterna" text null,
  "Borrado" text null,
  "IDPlanta" bigint null,
  "Planta" text null,
  "CveCiudad" text null,
  "IDMarca" bigint null,
  "MarcaCamion" text null,
  "IDTipoCombustible" bigint null,
  "TipoCombustible" text null,
  "IDTipoPlacas" bigint null,
  "TipoPlacas" text null,
  "Activo" text null,
  "Modelo" text null,
  "NumSerie" text null,
  "Placas" text null,
  constraint Unidades_pkey primary key ("IDUnidad")
) TABLESPACE pg_default;


Relaciones 
TanqueMovimiento.IdTanque = Tanque.IDTanque
TanqueMovimiento.IdUnidad = Unidades.IDUnidad